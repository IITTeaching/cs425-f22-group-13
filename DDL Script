DROP TABLE IF EXISTS Branches CASCADE;
DROP TABLE IF EXISTS Customers CASCADE;
DROP TABLE IF EXISTS Employees CASCADE;
DROP TABLE IF EXISTS Account CASCADE;
DROP TABLE IF EXISTS Owns CASCADE;
DROP TABLE IF EXISTS Transactions CASCADE;
DROP ROLE IF EXISTS teller;
DROP ROLE IF EXISTS manager;
DROP ROLE IF EXISTS customer;
DROP USER IF EXISTS bob;
DROP USER IF EXISTS john;
DROP USER IF EXISTS sam;



CREATE TABLE Branches
(
Address VARCHAR(20),
PRIMARY KEY (Address)
);

CREATE TABLE Customers
( 
SSN CHAR(9),
Name VARCHAR(20),
Address VARCHAR(20),
HomeBranch VARCHAR(20),


PRIMARY KEY (SSN),
FOREIGN KEY (HomeBranch) REFERENCES Branches(Address)
);

CREATE TABLE Employees
 (
SSN CHAR(9),
Name VARCHAR(20),
Address VARCHAR(20),
Branch VARCHAR(20),
Type VARCHAR(20),
Salary DECIMAL(13,2),


PRIMARY KEY (SSN),
FOREIGN KEY (Branch) REFERENCES Branches(Address)
);

CREATE TABLE Account
 (
Number CHAR(10),
Type VARCHAR(20),
Balance DECIMAL(13,2),
Owner CHAR(9),
 
PRIMARY KEY (Number),
FOREIGN KEY (Owner) REFERENCES Customers(SSN)
);


CREATE TABLE Owns
(
SSN CHAR(9),
Number CHAR(10),


PRIMARY KEY(SSN, NUMBER),
FOREIGN KEY(Number) REFERENCES Account(Number),
FOREIGN KEY(SSN) REFERENCES Customers(SSN)
);

CREATE TABLE Transactions
 (
Type VARCHAR(20),
Amount DECIMAL(13,2),
Description VARCHAR(20),
ID CHAR(20),
DepositAccountID CHAR(10),
WithdrawalAccountID CHAR(10),
 
PRIMARY KEY (ID),
FOREIGN KEY (DepositAccountID) REFERENCES Account(NUMBER),
FOREIGN KEY (WithdrawalAccountID) REFERENCES Account(Number)
);


CREATE role teller;
GRANT SELECT on Account TO teller;
GRANT SELECT on Transactions TO teller;
GRANT UPDATE on Transactions TO teller;


CREATE role manager;
GRANT ALL PRIVILEGES ON ALL TABLES IN SCHEMA public TO manager;
GRANT ALL PRIVILEGES ON ALL SEQUENCES IN SCHEMA public TO manager;


CREATE role customer;
GRANT SELECT ON Account TO customer;

CREATE USER bob WITH LOGIN PASSWORD 'password123';
GRANT manager TO bob;

CREATE USER john WITH LOGIN PASSWORD 'password456';
GRANT teller TO john;

CREATE USER sam WITH LOGIN PASSWORD 'password789';
GRANT customer TO sam;